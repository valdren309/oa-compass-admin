<!-- src/app/components/config/config.component.html -->

<mat-card class="config-card oa-config-root">
  <mat-card-title class="config-title-row">
    <span>{{ 'oa.config.title' | translate }}</span>
    <span class="config-title-spacer"></span>
  </mat-card-title>

  <mat-card-content>

    <!-- Loading state -->
    <div *ngIf="loading" class="config-loading">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>

    <!-- Main form -->
    <form
      class="config-form"
      *ngIf="!loading">

      <!-- Proxy / connection settings -->
      <section class="config-section">
        <h3 class="config-section__title">
          {{ 'oa.config.proxyTitle' | translate }}
        </h3>
        <p class="config-section__help">
          {{ 'oa.config.proxyHelp' | translate }}
        </p>

        <div class="config-grid">
          <mat-form-field appearance="fill">
            <mat-label>
              {{ 'oa.config.proxyBaseUrlLabel' | translate }}
            </mat-label>
            <input
              matInput
              [(ngModel)]="config.proxyBaseUrl"
              name="proxyBaseUrl"
              placeholder="https://app.lib.iastate.edu/oa-proxy">
          </mat-form-field>
        </div>
      </section>

      <!-- OA username storage (institution-wide) -->
      <section class="config-section">
        <h3 class="config-section__title">
          {{ 'oa.config.usernameStorageTitle' | translate }}
        </h3>
        <p class="config-section__help">
          {{ 'oa.config.usernameStorageHelp' | translate }}
        </p>

        <div class="config-grid">

          <!-- OA identifier type code -->
          <mat-form-field appearance="fill">
            <mat-label>
              {{ 'oa.config.oaIdTypeCodeLabel' | translate }}
            </mat-label>
            <input
              matInput
              [(ngModel)]="config.oaIdTypeCode"
              name="oaIdTypeCode"
              placeholder="02">
          </mat-form-field>

          <!-- Primary field -->
          <mat-form-field appearance="fill">
            <mat-label>
              {{ 'oa.config.primaryFieldLabel' | translate }}
            </mat-label>
            <mat-select
              [(ngModel)]="config.oaPrimaryField"
              name="oaPrimaryField">
              <mat-option
                *ngFor="let opt of primaryFieldOptions"
                [value]="opt.value">
                {{ opt.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Secondary field -->
          <mat-form-field appearance="fill">
            <mat-label>
              {{ 'oa.config.secondaryFieldLabel' | translate }}
            </mat-label>
            <mat-select
              [(ngModel)]="config.oaSecondaryField"
              name="oaSecondaryField">
              <mat-option
                *ngFor="let opt of secondaryFieldOptions"
                [value]="opt.value">
                {{ opt.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </div>
      </section>

      <!-- Actions -->
      <div class="oa-footer-actions">
        <button
          mat-flat-button
          type="button"
          (click)="onCancel()">
          Cancel
        </button>

        <button
          mat-flat-button
          color="primary"
          type="button"
          (click)="onSave()">
          Save
        </button>
      </div>

      <!-- Messages -->
      <div class="config-messages">
        <span *ngIf="saved" class="config-success">
          {{ 'oa.config.savedMessage' | translate }}
        </span>
        <span *ngIf="error" class="config-error">
          {{ error }}
        </span>
      </div>
    </form>

  </mat-card-content>
</mat-card>
