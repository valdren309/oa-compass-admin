<!-- src/app/components/settings/settings.component.html -->

<mat-card class="settings-card">
  <mat-card-title class="settings-title-row">
    <span>OA Compass settings</span>
    <span class="settings-title-spacer"></span>
  </mat-card-title>

  <mat-card-content>

    <!-- Loading state -->
    <div *ngIf="loading" class="settings-loading">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>

    <form
      class="settings-form"
      *ngIf="!loading">

      <!-- OA username storage (institution-level, read-only) -->
      <section class="settings-section">
        <h3 class="settings-section__title">OA username storage</h3>
        <p class="settings-section__help">
          These settings are configured at the institution level in the
          <strong>Configuration</strong> view and apply to all OA Compass users.
        </p>

        <div class="settings-grid">
          <div class="settings-select">
            <div class="settings-select__label">Primary field</div>
            <div class="settings-select__box">
              {{ settings.oaPrimaryField || 'job_description' }}
            </div>
          </div>

          <div class="settings-select">
            <div class="settings-select__label">Secondary field</div>
            <div class="settings-select__box">
              {{ settings.oaSecondaryField || 'none' }}
            </div>
          </div>
        </div>
      </section>

      <!-- Display options (per-user) -->
      <section class="settings-section">
        <h3 class="settings-section__title">Display options</h3>
        <p class="settings-section__help">
          These options only affect your view of the OA Compass Admin app.
        </p>

        <mat-checkbox
          [(ngModel)]="settings.showDebugPanel"
          name="showDebugPanel"
          (change)="toggleDebug()">
          Show debug / proxy response panel
        </mat-checkbox>
      </section>

      <!-- Actions -->
      <div class="settings-actions">
        <button
          mat-stroked-button
          type="button"
          (click)="resetToDefaults()"
          [disabled]="saving || loading">
          Reset
        </button>

        <span class="settings-actions__spacer"></span>

        <button
          mat-flat-button
          color="primary"
          type="button"
          (click)="save()"
          [disabled]="saving || loading">
          Save
        </button>
      </div>

      <!-- Messages -->
      <div class="settings-messages">
        <span *ngIf="saved" class="settings-success">
          Settings saved.
        </span>
        <span *ngIf="error" class="settings-error">
          {{ error }}
        </span>
      </div>
    </form>

  </mat-card-content>
</mat-card>
