<!-- src/app/components/settings/settings.component.html -->

<mat-card class="settings-card">
  <mat-card-title class="settings-title-row">
    <span>{{ 'oa.settings.title' | translate }}</span>
    <span class="settings-title-spacer"></span>
  </mat-card-title>

  <mat-card-content>

    <!-- Loading state -->
    <div *ngIf="loading" class="settings-loading">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>

    <form
      class="settings-form"
      *ngIf="!loading">

      <!-- OA username storage (institution-level, read-only) -->
      <section class="settings-section">
        <h3 class="settings-section__title">
          {{ 'oa.settings.usernameStorageTitle' | translate }}
        </h3>
        <p class="settings-section__help">
          {{ 'oa.settings.usernameStorageHelp' | translate }}
        </p>

        <div class="settings-grid">
          <div class="settings-select">
            <div class="settings-select__label">
              {{ 'oa.settings.primaryFieldLabel' | translate }}
            </div>
            <div class="settings-select__box">
              {{ settings.oaPrimaryField || 'job_description' }}
            </div>
          </div>

          <div class="settings-select">
            <div class="settings-select__label">
              {{ 'oa.settings.secondaryFieldLabel' | translate }}
            </div>
            <div class="settings-select__box">
              {{ settings.oaSecondaryField || 'none' }}
            </div>
          </div>
        </div>
      </section>

      <!-- Display options (per-user) -->
      <section class="settings-section">
        <h3 class="settings-section__title">
          {{ 'oa.settings.displayOptionsTitle' | translate }}
        </h3>
        <p class="settings-section__help">
          {{ 'oa.settings.displayOptionsHelp' | translate }}
        </p>

        <mat-checkbox
          [(ngModel)]="settings.showDebugPanel"
          name="showDebugPanel"
          (change)="toggleDebug()">
          {{ 'oa.settings.showDebugPanelLabel' | translate }}
        </mat-checkbox>
      </section>

      <!-- Actions -->
      <div class="settings-actions">
        <button
          mat-stroked-button
          type="button"
          (click)="resetToDefaults()"
          [disabled]="saving || loading">
          {{ 'oa.actions.reset' | translate }}
        </button>

        <span class="settings-actions__spacer"></span>

        <button
          mat-flat-button
          color="primary"
          type="button"
          (click)="save()"
          [disabled]="saving || loading">
          {{ 'oa.actions.save' | translate }}
        </button>
      </div>

      <!-- Messages -->
      <div class="settings-messages">
        <span *ngIf="saved" class="settings-success">
          {{ 'oa.settings.savedMessage' | translate }}
        </span>
        <span *ngIf="error" class="settings-error">
          {{ error }}
        </span>
      </div>
    </form>

  </mat-card-content>
</mat-card>
